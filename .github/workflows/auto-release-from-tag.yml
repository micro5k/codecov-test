---
# SPDX-FileCopyrightText: (c) 2022 ale5000
# SPDX-License-Identifier: GPL-3.0-or-later

name: "Auto-release from tag"
permissions: {}
on:
  push:
    tags:
      - "v*"
  workflow_dispatch:
jobs:
  base-job:
    name: "Release"
    runs-on: ubuntu-latest
    if: "startsWith(github.ref, 'refs/tags/v')"
    permissions:
      contents: write

    steps:
      - name: "Checkout sources"
        uses: actions/checkout@v4
      - name: "Setup Java"
        uses: actions/setup-java@v4
        with:
          distribution: "temurin"
          java-version: "17"
      - name: "Build"
        shell: bash
        run: |
          ### Building...
          '${{ github.workspace }}/gradlew' clean buildOtaOSS
      - name: "Upload release"
        uses: ncipollo/release-action@v1
        with:
          allowUpdates: true
          artifactErrorsFailBuild: false
          artifacts: "output/*.zip*"
          body: "See the full [**changelog**](./CHANGELOG.rst)."
          replacesArtifacts: false
